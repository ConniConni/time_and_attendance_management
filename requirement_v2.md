# 勤怠管理システム 要件定義書 v2.0

## 改訂履歴サマリー
本バージョンでは、v1.0の論理的矛盾、エッジケースの考慮漏れ、実装困難な要件を修正しました。
詳細は「付録A: v1.0からの主要変更点」を参照してください。

---

## 1. プロジェクト概要

### 1.1 システム名
勤怠管理システム（Time and Attendance Management System）

### 1.2 システム目的
従業員の勤怠管理を効率化し、労働時間の適切な管理と法令遵守を実現する。

### 1.3 対象ユーザー
- 一般従業員：出退勤打刻、残業申請
- 管理者：部下の勤怠状況確認、承認業務
- 人事部：残業時間の承認、データ管理

---

## 2. 仮定一覧

本要件定義書では、以下の仮定に基づいて要件を補完しています。

| ID | 仮定内容 |
|---|---|
| ASM-001 | 打刻時にGPS位置情報を取得するが、取得は任意（失敗時も打刻可能） |
| ASM-002 | 所定労働時間は9:00-18:00（休憩12:00-13:00の1時間を除く実働8時間） |
| ASM-003 | 残業申請の第一承認者は直属の上司（管理者）とする |
| ASM-004 | 人事部の承認は月次残業が60時間を超える場合に必要（36協定特別条項） |
| ASM-005 | データ保持期間5年は労働基準法第109条に基づく |
| ASM-006 | システムはWebブラウザおよびモバイルアプリ（PWA）で提供される |
| ASM-007 | 打刻の修正は管理者承認が必要（ワークフロー管理） |
| ASM-008 | 残業の事前申請が原則だが、緊急時は事後申請も認める |
| ASM-009 | 月次の勤怠データは翌月10営業日までに確定する |
| ASM-010 | ユーザー認証は既存の社内認証システム（SAML/OAuth2.0）と連携する |
| ASM-011 | 休憩時間は原則12:00-13:00の1時間とし、自動控除する |
| ASM-012 | 深夜労働（22:00-翌5:00）は割増賃金の対象として別途管理する |

---

## 3. 機能要件

### 3.1 打刻機能

#### REQ-001: スマートフォンによる出勤打刻
**優先度**: 高
**説明**: 従業員がスマートフォンから出勤時刻を打刻できる。
**詳細要件**:
- スマートフォンのブラウザまたはPWAアプリから打刻可能
- 打刻時刻は秒単位（ISO 8601形式）で記録される
- GPS位置情報の取得を試みるが、取得失敗時も打刻を許可する
- GPS取得失敗時は「位置情報なし」として記録し、後で管理者確認が必要
- 打刻完了後、確認メッセージと打刻時刻を表示する
- **オフライン対応**: ネットワーク接続がない場合はローカルに保存し、接続回復時に自動送信
- **二重打刻防止**: 同日の出勤打刻が既に存在する場合は警告を表示し、上書き確認を求める

#### REQ-002: スマートフォンによる退勤打刻
**優先度**: 高
**説明**: 従業員がスマートフォンから退勤時刻を打刻できる。
**詳細要件**:
- REQ-001と同様の仕様を適用
- 退勤打刻時に当日の勤務時間（休憩時間控除後）を表示する
- 残業が発生する場合は残業時間と承認状況を表示する
- **未承認残業の警告**: 残業申請が未承認の場合、確認を促すメッセージを表示
- **打刻順序チェック**: 出勤打刻がない場合はエラーを表示し、打刻修正申請を促す
- **日付またぎ対応**: 深夜勤務の場合、退勤日を明示的に表示（例: 12/16 2:00 退勤）

#### REQ-002-1: 中抜け・再入機能
**優先度**: 中
**説明**: 勤務時間中の外出・戻りを記録できる。
**詳細要件**:
- 「外出」「戻り」の打刻ボタンを提供
- 外出時間は自動的に勤務時間から控除される
- 1日に複数回の外出・戻りが可能
- 外出中に退勤打刻しようとした場合は警告を表示

#### REQ-003: 打刻履歴の表示
**優先度**: 中
**説明**: 従業員が自分の打刻履歴を確認できる。
**詳細要件**:
- 月次・週次・日次での表示切り替えが可能
- 打刻時刻、場所（エリア名のみ）、勤務時間、残業時間が表示される
- 過去2年分の履歴が閲覧可能（v1.0の6ヶ月から拡大）
- **検索・フィルタ機能**: 日付範囲、打刻状態（正常/修正中/エラー）で絞り込み可能
- **異常の可視化**: 打刻忘れ、GPS未取得などの異常をアイコンで表示

#### REQ-004: 打刻修正申請
**優先度**: 高
**説明**: 打刻忘れや誤打刻の修正を申請できる。
**詳細要件**:
- 修正対象日、修正内容（出勤/退勤/外出/戻り）、修正理由を入力
- 修正理由の入力が必須（100文字以上を推奨）
- 管理者の承認が必要
- 承認/却下の通知をメールおよびアプリ内通知で受け取る
- **修正期限**: 対象日から30日以内に申請が必要
- **修正履歴**: 修正前後の内容を監査ログとして保存

---

### 3.2 残業申請機能

#### REQ-005: 事前残業申請
**優先度**: 高
**説明**: 従業員が事前に残業を申請できる。
**詳細要件**:
- 申請日、予定残業開始時刻、予定残業終了時刻、理由を入力
- 申請は勤務日の前営業日17:00までに提出（土日祝を考慮）
- 承認者（直属の上司）に通知が送信される
- 申請状態（申請中/承認済/却下/取り下げ）が確認できる
- **複数日申請**: 連続した複数日の残業を一括申請可能
- **取り下げ機能**: 承認前であれば申請者が取り下げ可能

#### REQ-006: 当日・事後残業申請
**優先度**: 高
**説明**: 緊急時には当日または事後に残業を申請できる。
**詳細要件**:
- **当日申請**: 勤務当日の0:00以降に申請可能
- **事後申請**: 退勤打刻後48時間以内に申請可能
- 「緊急」フラグが自動的に付与される
- 事前申請と同様の承認フローを経る
- **事後申請のペナルティ**: 月3回以上の事後申請は管理者に警告通知

#### REQ-006-1: 残業申請と実績の突合
**優先度**: 高
**説明**: 残業申請時間と実際の残業時間の差異を管理する。
**詳細要件**:
- 退勤打刻時に申請時間と実績時間を自動比較
- 差異が30分以上ある場合は管理者に通知
- 実績が申請を超える場合、超過分は「未申請残業」として別途記録
- 管理者は実績時間に基づいて承認時間を調整可能

#### REQ-007: 残業申請の承認/却下
**優先度**: 高
**説明**: 管理者が残業申請を承認または却下できる。
**詳細要件**:
- 申請一覧から個別に承認/却下を選択
- 却下時はコメント入力が必須
- 承認/却下時に申請者へ通知
- **承認期限**: 申請から5営業日以内に承認・却下が必要（期限超過時は人事部へエスカレーション）
- **条件付き承認**: 申請時間の一部のみ承認することが可能（例: 申請3時間のうち2時間のみ承認）

---

### 3.3 残業時間管理

#### REQ-008: 月次残業時間の自動集計
**優先度**: 高
**説明**: システムが自動的に月次の残業時間を集計する。
**詳細要件**:
- **集計対象**: 承認済み残業時間のみ（未承認・却下は除外）
- **集計タイミング**: 毎日深夜0:30に前日分を集計（日付またぎ勤務を考慮）
- **暫定集計**: 未承認残業も「暫定残業時間」として別途集計し、参考表示
- 残業時間が40時間を超えた場合、従業員と管理者に警告を表示
- **日付またぎの扱い**: 深夜勤務は「勤務開始日」の残業として集計

#### REQ-009: 60時間超過時の人事部承認
**優先度**: 高
**説明**: 月の残業時間が60時間を超える場合、人事部の承認が必要。
**詳細要件**:
- 承認済み残業時間の累計が60時間に達した時点で、次の残業申請時に自動的に人事部へ通知
- **二段階承認**: 直属上司の承認後、人事部の承認が必要（並列承認ではなく直列）
- 人事部が承認するまで60時間超過分の残業は「仮承認」状態
- 承認/却下の理由を記録する
- 36協定の特別条項に基づく承認フローとして扱う
- **月次給与との連携**: 給与計算締め日（翌月5営業日）までに人事部承認を完了させる

#### REQ-010: 残業時間の上限アラート
**優先度**: 高
**説明**: 法定上限に近づいた場合、警告を表示する。
**詳細要件**:
- **監視対象**: 月80時間（複数月平均）、月100時間（単月上限）、年720時間
- 上限の80%到達時に従業員と管理者に警告（黄色アラート）
- 上限の90%到達時に従業員、管理者、人事部に警告（赤色アラート）
- **申請制限**: 月100時間または年720時間を超える申請は警告を表示し、人事部の事前承認が必要
- **違法労働の防止**: 法定上限を超える承認はシステムで拒否（特別な理由がある場合は人事部が手動で処理）

#### REQ-010-1: 複数月平均80時間の監視
**優先度**: 高
**説明**: 2-6ヶ月平均の残業時間が80時間を超えないよう監視する。
**詳細要件**:
- 毎月、過去2ヶ月、3ヶ月、4ヶ月、5ヶ月、6ヶ月の平均残業時間を計算
- いずれかの平均が80時間を超える場合、警告を表示
- 人事部に月次レポートとして提出

---

### 3.4 管理者機能

#### REQ-011: 部下の勤怠状況確認
**優先度**: 高
**説明**: 管理者が部下の勤怠状況を確認できる。
**詳細要件**:
- 組織階層に基づき、直属の部下のみ閲覧可能
- 月次・週次・日次での集計表示
- 打刻状況、残業時間、申請状況、未承認件数を一覧表示
- CSVエクスポート機能
- **リアルタイム表示**: 当日の出勤状況をリアルタイムで確認可能
- **異常の優先表示**: 打刻忘れ、過度な残業、未承認申請を優先的に表示

#### REQ-012: 勤怠異常の検知
**優先度**: 高
**説明**: 管理者に勤怠異常を自動検知して通知する。
**詳細要件**:
- **検知項目**: 打刻忘れ、過度な残業（月80時間以上）、深夜労働（22:00-5:00）、連続勤務（7日以上）
- ダッシュボードに異常件数を表示
- 毎週月曜日に週次レポートをメールで送信
- **アラート優先度**: 緊急（赤）、警告（黄）、情報（青）の3段階で分類

#### REQ-013: 承認業務の一括処理
**優先度**: 中
**説明**: 複数の申請を一括で承認/却下できる。
**詳細要件**:
- チェックボックスで複数選択（最大50件まで）
- 一括承認時は確認ダイアログを表示
- 処理結果をログに記録
- **一括却下の制限**: 却下はコメントが必須のため、一括却下は不可（個別のみ）

#### REQ-013-1: 代理承認機能
**優先度**: 高
**説明**: 承認者が不在時に代理で承認できる。
**詳細要件**:
- 事前に代理承認者を設定可能（最大3名）
- 休暇・出張時に自動的に代理承認者へ通知を転送
- 代理承認の場合、監査ログに「代理承認」と記録
- 本来の承認者が復帰後、代理承認内容を確認可能

---

### 3.5 休日・休暇管理

#### REQ-014: 休日・祝日の管理
**優先度**: 高
**説明**: 休日・祝日の勤務を適切に管理する。
**詳細要件**:
- カレンダー設定で休日・祝日を事前登録
- 休日出勤の場合、通常の打刻とは別に「休日出勤」フラグを付与
- 休日出勤は事前申請が必須（緊急時は事後申請可）
- 休日出勤の時間は通常残業とは別に集計（割増率が異なるため）

#### REQ-015: 代休・振替休日の管理
**優先度**: 中
**説明**: 休日出勤に対する代休・振替休日を管理する。
**詳細要件**:
- 休日出勤時に代休取得の要否を記録
- 代休は休日出勤から1ヶ月以内に取得を推奨
- 代休未取得の場合、管理者に通知

---

### 3.6 データ管理

#### REQ-016: 勤怠データの5年間保持
**優先度**: 高
**説明**: 過去の勤怠データを5年間保持する。
**詳細要件**:
- 全ての打刻記録、申請記録、承認記録、修正履歴を保持
- **確定の定義**: 月次勤怠確定処理（翌月10営業日）後のデータは原則編集不可
- 確定後の修正は特別な承認フロー（人事部長承認）が必要
- 5年経過後は自動的にアーカイブストレージに移行（読み取り専用）
- 法的要求に基づき、必要時は復元可能（復元には3営業日を要する）

#### REQ-017: データのバックアップ
**優先度**: 高
**説明**: 勤怠データの定期バックアップを実施する。
**詳細要件**:
- 日次で自動バックアップを実行（毎日深夜2:00）
- バックアップデータは別拠点（地理的に離れたデータセンター）に保管
- 世代管理: 日次7世代、週次4世代、月次12世代を保持
- 月次でバックアップの整合性を検証（リストアテスト）

#### REQ-018: 監査ログの記録
**優先度**: 高
**説明**: 全ての操作を監査ログに記録する。
**詳細要件**:
- **記録内容**: ユーザー操作、承認操作、データ修正、ログイン/ログアウト、CSV出力
- **記録項目**: タイムスタンプ、ユーザーID、操作内容、IPアドレス、変更前後の値
- ログは5年間保持（改ざん防止のため、追記のみ可能）
- **アクセス制限**: 監査ログは人事部およびシステム管理者のみ閲覧可能

---

## 4. 非機能要件

### 4.1 性能要件

#### REQ-019: レスポンス時間
**説明**: 通常操作のレスポンス時間は3秒以内とする。
**詳細**:
- 打刻操作：1秒以内
- 画面遷移：2秒以内
- レポート生成：10秒以内（大量データの場合。進捗バーを表示）
- **ネットワーク遅延**: 4G/LTE環境を想定（3G環境では性能保証外）

#### REQ-020: 同時アクセス
**説明**: 最大1,000ユーザーの同時アクセスに対応する。
**詳細**:
- 出勤時間帯（8:00-9:30）のピーク時を想定
- システムダウンなく処理できること
- **負荷分散**: ロードバランサーによる複数サーバー構成
- **キューイング**: 同時アクセスが上限を超えた場合、待機キューで対応（最大待機時間30秒）

---

### 4.2 セキュリティ要件

#### REQ-021: 認証・認可
**説明**: 適切な認証と認可を実施する。
**詳細**:
- 社内シングルサインオン（SSO）と連携（SAML 2.0 / OAuth 2.0）
- ロールベースアクセス制御（RBAC）を実装（従業員/管理者/人事部/システム管理者）
- セッションタイムアウト：30分（操作なしの場合）
- **多要素認証（MFA）**: 人事部およびシステム管理者は必須

#### REQ-022: 通信の暗号化
**説明**: 全ての通信をHTTPS/TLSで暗号化する。
**詳細**:
- TLS 1.2以上を使用
- HTTP通信は自動的にHTTPSへリダイレクト

#### REQ-023: 個人情報・位置情報の保護
**説明**: 個人情報保護法に準拠したデータ管理を行う。
**詳細**:
- **位置情報の扱い**: GPS座標は保存せず、住所レベル（市区町村+エリア名）に変換して保存
- 詳細な位置情報は打刻後24時間で自動削除
- アクセスログに基づく不正アクセス監視
- **データ暗号化**: データベース内の個人情報は暗号化して保存（AES-256）

---

### 4.3 可用性要件

#### REQ-024: システム稼働率
**説明**: 稼働率99.5%以上を維持する。
**詳細**:
- 計画メンテナンス時間を除く（年間ダウンタイム43.8時間以内）
- メンテナンスは月1回、深夜時間帯（2:00-5:00）に実施
- メンテナンスは1週間前に予告

#### REQ-025: 障害復旧
**説明**: 障害発生時は迅速に復旧する。
**詳細**:
- **目標復旧時間（RTO）**: 2時間以内
- **目標復旧時点（RPO）**: 1時間以内（最大1時間分のデータ損失を許容）
- 冗長化構成（アクティブ-スタンバイ）によるフェイルオーバー
- 自動フェイルオーバー時の目標切替時間：5分以内
- 復旧手順書を整備し、四半期ごとに訓練を実施

---

### 4.4 ユーザビリティ要件

#### REQ-026: モバイル対応
**説明**: スマートフォンで快適に操作できるUIを提供する。
**詳細**:
- レスポンシブデザイン（モバイルファースト）
- iOS 14以上、Android 10以上に対応
- PWA（Progressive Web App）として実装し、ホーム画面への追加が可能
- 画面サイズ：4.7インチ以上を推奨
- **オフライン動作**: 打刻機能は完全オフライン対応

#### REQ-027: アクセシビリティ
**説明**: WCAG 2.1 レベルAAに準拠する。
**詳細**:
- スクリーンリーダー対応
- キーボード操作のみで全機能を利用可能
- カラーコントラスト比4.5:1以上

#### REQ-028: 多言語対応
**優先度**: 低（将来対応）
**説明**: 日本語・英語の切り替えが可能。
**詳細**:
- UI表示言語の切り替え
- 通知メールの多言語化

---

## 5. システム制約

### 5.1 技術制約
- 既存の社内認証システム（ActiveDirectory / Okta）との連携が必須
- 社内ネットワークからのアクセスを基本とするが、VPN経由での外部アクセスも許可
- 既存の給与計算システムとCSVインターフェースで連携

### 5.2 運用制約
- 月次勤怠確定処理は翌月10営業日までに実施（給与計算締め日を考慮）
- 確定処理前に管理者による目視確認が必要
- 5年間のデータ保持は労働基準法第109条に基づく
- システムメンテナンスは深夜時間帯（2:00-5:00）のみ許可

### 5.3 法規制
- 労働基準法（特に第32条、第36条、第109条）
- 労働安全衛生法
- 個人情報保護法
- 36協定（時間外労働・休日労働に関する協定）

---

## 6. 用語集

| 用語 | 定義 |
|---|---|
| 打刻 | 出勤・退勤・外出・戻りの時刻を記録する行為 |
| 所定労働時間 | 9:00-18:00（休憩12:00-13:00を除く実働8時間） |
| 残業 | 所定労働時間を超える労働（18:00以降または9:00以前） |
| 深夜労働 | 22:00-翌5:00の労働（割増賃金の対象） |
| 36協定 | 労働基準法第36条に基づく時間外労働・休日労働に関する協定 |
| 管理者 | 部下の勤怠管理を行う上司（課長、部長等） |
| 人事部 | 全社的な勤怠管理と労務管理を担当する部門 |
| 月次確定 | 翌月10営業日までに実施する勤怠データの確定処理 |
| 代理承認者 | 承認者不在時に代理で承認業務を行う者 |
| 営業日 | 土日祝を除く平日（会社カレンダーに基づく） |

---

## 7. 変更履歴

| 版 | 日付 | 変更内容 | 作成者 |
|---|---|---|
| 1.0 | 2025-12-15 | 初版作成 | - |
| 2.0 | 2025-12-15 | 論理的矛盾の修正、エッジケースの追加、実装困難な要件の見直し | - |

---

## 8. 補足事項

### 8.1 今後の検討事項
- 有給休暇管理機能との連携
- 勤務パターンの柔軟な設定（フレックスタイム、シフト制、裁量労働制）
- スマートウォッチ等のウェアラブルデバイス対応
- AI による勤怠異常検知の高度化
- 在宅勤務・リモートワークの専用管理機能
- 交通費精算との連携

### 8.2 参考資料
- 労働基準法
- 36協定ガイドライン（厚生労働省）
- 個人情報保護法ガイドライン
- 勤怠管理システム導入ガイド（日本経団連）

---

## 付録A: v1.0からの主要変更点

### A.1 論理的矛盾の修正

| 項目 | v1.0の問題 | v2.0の修正内容 |
|---|---|---|
| 休憩時間 | 9:00-18:00を所定労働時間としていたが、休憩時間が未定義 | ASM-002で休憩時間12:00-13:00を明記。実働8時間を明確化 |
| 残業上限の矛盾 | REQ-009で60時間超過は人事承認、REQ-010で上限超過は自動却下と矛盾 | REQ-010を修正し、月100時間・年720時間の法定上限を明確化。60時間超過は人事承認で対応可能に |
| 事後承認の扱い | 承認済みのみ集計するが、事後承認可能で集計タイミングが曖昧 | REQ-008に「暫定残業時間」の概念を追加。未承認分も参考表示 |
| データ閲覧期間 | 5年保持するのに6ヶ月しか閲覧できない理由不明 | REQ-003を修正し、2年分の閲覧を可能に |
| 月次確定の矛盾 | 翌月5営業日確定だが、人事承認が間に合わない可能性 | ASM-009を10営業日に変更。REQ-009で給与計算との連携を明記 |

### A.2 エッジケースの追加

| 追加項目 | 要件ID | 内容 |
|---|---|---|
| 日付またぎ勤務 | REQ-002, REQ-008 | 深夜勤務の退勤日表示、勤務開始日での集計ルールを明記 |
| 通信エラー対応 | REQ-001, REQ-002 | オフライン時のローカル保存、GPS取得失敗時の処理を追加 |
| 二重打刻防止 | REQ-001 | 同日の重複打刻時の警告と上書き確認を追加 |
| 打刻順序エラー | REQ-002 | 出勤打刻なしでの退勤打刻エラー処理を追加 |
| 承認者不在対応 | REQ-013-1 | 代理承認機能を新規追加 |
| 承認期限 | REQ-007 | 5営業日以内の承認期限を設定、超過時のエスカレーション |
| 休日・祝日 | REQ-014, REQ-015 | 休日出勤、代休・振替休日の管理機能を新規追加 |
| 中抜け対応 | REQ-002-1 | 外出・戻りの打刻機能を新規追加 |
| 申請と実績の乖離 | REQ-006-1 | 残業申請時間と実績時間の突合機能を新規追加 |
| 複数月平均監視 | REQ-010-1 | 2-6ヶ月平均80時間の監視機能を新規追加 |

### A.3 実装困難な要件の修正

| 項目 | v1.0の問題 | v2.0の修正内容 |
|---|---|---|
| GPS匿名化の矛盾 | 打刻場所を記録しつつ匿名化は技術的に矛盾 | REQ-023で詳細座標を24時間で削除、エリアレベル（市区町村）のみ保存と明記 |
| データ改ざん防止 | 確定後編集不可だが、打刻修正可能で矛盾 | REQ-016で確定の定義を明確化。確定後の修正は特別承認フローが必要と変更 |
| 自動フェイルオーバー | 2時間復旧と自動フェイルオーバーの時間が矛盾 | REQ-025で自動切替5分以内、完全復旧2時間以内と明確に区別 |

### A.4 新規追加要件

| 要件ID | 要件名 | 追加理由 |
|---|---|---|
| REQ-002-1 | 中抜け・再入機能 | 外出・戻りの管理が必要なため |
| REQ-006-1 | 残業申請と実績の突合 | 申請時間と実労働時間の乖離を管理するため |
| REQ-010-1 | 複数月平均80時間の監視 | 労働基準法の要求に対応するため |
| REQ-013-1 | 代理承認機能 | 承認者不在時の業務継続性のため |
| REQ-014 | 休日・祝日の管理 | 休日出勤の適切な管理のため |
| REQ-015 | 代休・振替休日の管理 | 休日出勤に対する代休管理のため |
| REQ-028 | 多言語対応 | 将来的なグローバル展開を見据えて |

### A.5 仮定の追加・修正

| 仮定ID | v1.0 | v2.0 |
|---|---|---|
| ASM-001 | GPSによる認証を含む | GPS取得は任意（失敗時も打刻可能）に変更 |
| ASM-002 | 9:00-18:00を基本 | 休憩時間12:00-13:00を明記 |
| ASM-009 | 翌月5営業日確定 | 翌月10営業日確定に変更 |
| ASM-011 | - | 休憩時間の自動控除を新規追加 |
| ASM-012 | - | 深夜労働の別途管理を新規追加 |

---

**以上**
